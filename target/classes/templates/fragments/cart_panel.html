<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<body>
<section th:fragment="panel" id="cart-panel">
  <div class="cart-shell card" id="cart-shell">
    <div class="cart-header">
      <h3 class="m-0">Cart</h3>
      <div th:if="${!#lists.isEmpty(cartSummary.groups)}">
        <form th:action="@{|/e/${event.code}/cart/clear|}" method="post"
              th:attr="hx-post=@{|/e/${event.code}/cart/clear|}"
              hx-target="#cart-panel" hx-swap="outerHTML">
          <button class="btn btn-outline btn-sm" type="submit" aria-label="Clear Cart">Clear</button>
        </form>
      </div>
    </div>

  <div th:if="${errorMessage}" class="alert error" th:text="${errorMessage}">Error</div>
  <div th:if="${successMessage}" class="alert success" th:text="${successMessage}">Saved</div>

    <div th:if="${#lists.isEmpty(cartSummary.groups)}" class="empty-state">
      <p class="muted" style="margin:0;">Your cart is empty</p>
    </div>

    <div class="cart-groups" th:if="${!#lists.isEmpty(cartSummary.groups)}">
      <div th:each="group : ${cartSummary.groups}" class="cart-vendor">
        <div class="cart-vendor-header">
          <span class="vendor-name" th:text="${group.vendorName}">Vendor</span>
        </div>
        <div class="cart-lines">
          <div th:each="line : ${group.lines}" class="cart-line">
            <div class="line-info">
              <span class="line-name" th:text="${line.itemName}">Item</span>
              <span class="line-price" th:text="${#numbers.formatDecimal(line.subtotal, 1, 'DEFAULT', 2, 'DEFAULT')} + ' EGP'">0.00</span>
            </div>
            <div class="qty-stepper-compact" aria-label="Quantity selector">
              <form th:action="@{|/e/${event.code}/cart/set-qty|}" method="post"
                    th:attr="hx-post=@{|/e/${event.code}/cart/set-qty|}"
                    hx-target="#cart-panel" hx-swap="outerHTML" class="inline-form">
                <input type="hidden" name="vendorId" th:value="${group.vendorId}"/>
                <input type="hidden" name="itemId" th:value="${line.itemId}"/>
                <input type="hidden" name="qty" th:value="${line.qty - 1}"/>
                <button class="qty-btn-compact" type="submit" aria-label="Decrease">−</button>
              </form>
              <span class="qty-value-compact" th:text="${line.qty}">1</span>
              <form th:action="@{|/e/${event.code}/cart/set-qty|}" method="post"
                    th:attr="hx-post=@{|/e/${event.code}/cart/set-qty|}"
                    hx-target="#cart-panel" hx-swap="outerHTML" class="inline-form">
                <input type="hidden" name="vendorId" th:value="${group.vendorId}"/>
                <input type="hidden" name="itemId" th:value="${line.itemId}"/>
                <input type="hidden" name="qty" th:value="${line.qty + 1}"/>
                <button class="qty-btn-compact" type="submit" aria-label="Increase">+</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div th:if="${!#lists.isEmpty(cartSummary.groups)}" class="cart-summary">
      <div class="cart-total-row">
        <span>Subtotal</span>
        <span th:text="${#numbers.formatDecimal(cartSummary.grandSubtotal, 1, 'DEFAULT', 2, 'DEFAULT')} + ' EGP'">0.00</span>
      </div>
      <div class="cart-total-row" th:if="${cartSummary.discount > 0}">
        <span>Discount</span>
        <span>− <span th:text="${#numbers.formatDecimal(cartSummary.discount, 1, 'DEFAULT', 2, 'DEFAULT')} + ' EGP'">0.00</span></span>
      </div>
      <div class="cart-total-row cart-total-main">
        <span>Total</span>
        <span th:text="${#numbers.formatDecimal(cartSummary.grandTotal, 1, 'DEFAULT', 2, 'DEFAULT')} + ' EGP'">0.00</span>
      </div>

      <form th:action="@{|/e/${event.code}/checkout|}" method="post">
        <button class="btn btn-primary btn-lg" type="submit" style="width:100%;">Checkout</button>
      </form>
    </div>
  </div>
</section>
</body>
</html>
